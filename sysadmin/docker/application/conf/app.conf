<VirtualHost *:8080>
    ServerName localhost
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
    SetEnvIf X-Forwarded-Proto "^https$" HTTPS
    RemoteIPHeader X-Forwarded-For

    <Directory /var/www/app/private>
        AllowOverride None
        Options None
        Order allow,deny
        Allow from all
    </Directory>

    DocumentRoot /var/www/app/public
    <Directory /var/www/app/public>
        AllowOverride All
        Order Allow,Deny
        Allow from All

        <IfModule mod_rewrite.c>
            Options -MultiViews
            RewriteEngine On

            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteRule ^(.*)$ index.php [QSA,L]
        </IfModule>
        # Enable cross domain access control
        SetEnvIf Origin "^http(s)?://(git\.psychorama\.be)$" REQUEST_ORIGIN=$0
        SetEnvIf Origin "^http(s)?://(git\.psychorama\.test)$" REQUEST_ORIGIN=$0
        Header always set Access-Control-Allow-Origin %{REQUEST_ORIGIN}e env=REQUEST_ORIGIN
        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, HEAD"
        Header always set Access-Control-Allow-Headers "x-test-header, Origin, X-Requested-With, Content-Type, Accept, Authorization"

        # Force to request 204 for options
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} ^(OPTIONS|HEAD)
        RewriteRule .* / [R=204,L]
    </Directory>
    # Enable cross domain access control
    SetEnvIf Origin "^http(s)?://(git\.psychorama\.be)$" REQUEST_ORIGIN=$0
    SetEnvIf Origin "^http(s)?://(git\.psychorama\.test)$" REQUEST_ORIGIN=$0
    Header always set Access-Control-Allow-Origin %{REQUEST_ORIGIN}e env=REQUEST_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD"
    Header always set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Accept-Language,Authorization,Sec-Fetch-Site,Sec-Fetch-Dest,Sec-Fetch-Mode,TE"
    Header always set Access-Control-Expose-Headers "Content-Length,Content-Range,Content-Language,Cache-Control,Expires,Last-Modified,Pragma"
    Header always set Access-Control-Allow-Credentials true

    # Force to request 200 for options
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule .* / [R=204,L]

    PassEnv APP_ENV
    PassEnv APP_DEBUG
</VirtualHost>

<VirtualHost *:8082>
    ServerName localhost
    SetEnv APP_ENV "test"
    SetEnv APP_DEBUG "true"
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
    SetEnvIf X-Forwarded-Proto "^https$" HTTPS
    RemoteIPHeader X-Forwarded-For

    SSLEngine On
    SSLCertificateFile /etc/apache2/certs/server.crt
    SSLCertificateKeyFile /etc/apache2/certs/server.key
    SSLCACertificateFile /usr/local/share/ca-certificates/falcran-ca.crt

    <Directory /var/www/app/private>
        AllowOverride None
        Options None
        Order allow,deny
        Allow from all
    </Directory>

    DocumentRoot /var/www/app/public
    <Directory /var/www/app/public>
        AllowOverride All
        Order Allow,Deny
        Allow from All

        <IfModule mod_rewrite.c>
            Options -MultiViews
            RewriteEngine On

            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteRule ^(.*)$ index.php [QSA,L]
        </IfModule>
        # Enable cross domain access control
        SetEnvIf Origin "^http(s)?://(git\-test\.psychorama\.test)$" REQUEST_ORIGIN=$0
        Header always set Access-Control-Allow-Origin %{REQUEST_ORIGIN}e env=REQUEST_ORIGIN
        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, HEAD"
        Header always set Access-Control-Allow-Headers "x-test-header, Origin, X-Requested-With, Content-Type, Accept, Authorization"

        # Force to request 204 for options
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} ^(OPTIONS|HEAD)
        RewriteRule .* / [R=204,L]
    </Directory>

    # Enable cross domain access control
    SetEnvIf Origin "^http(s)?://(git\-test\.psychorama\.test)$" REQUEST_ORIGIN=$0
    Header always set Access-Control-Allow-Origin %{REQUEST_ORIGIN}e env=REQUEST_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD"
    Header always set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Accept-Language,Authorization,Sec-Fetch-Site,Sec-Fetch-Dest,Sec-Fetch-Mode,TE"
    Header always set Access-Control-Expose-Headers "Content-Length,Content-Range,Content-Language,Cache-Control,Expires,Last-Modified,Pragma"
    Header always set Access-Control-Allow-Credentials true

    # Force to request 200 for options
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule .* / [R=204,L]
</VirtualHost>

<VirtualHost *:8083>
    ServerName localhost
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
    SetEnvIf X-Forwarded-Proto "^https$" HTTPS
    RemoteIPHeader X-Forwarded-For

    SSLEngine On
    SSLCertificateFile /etc/apache2/certs/server.crt
    SSLCertificateKeyFile /etc/apache2/certs/server.key
    SSLCACertificateFile /usr/local/share/ca-certificates/falcran-ca.crt

    <Directory /var/www/app/private>
        AllowOverride None
        Options None
        Order allow,deny
        Allow from all
    </Directory>

    DocumentRoot /var/www/app/public
    <Directory /var/www/app/public>
        AllowOverride All
        Order Allow,Deny
        Allow from All

        <IfModule mod_rewrite.c>
            Options -MultiViews
            RewriteEngine On

            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteRule ^(.*)$ index.php [QSA,L]
        </IfModule>
        # Enable cross domain access control
        SetEnvIf Origin "^http(s)?://(git\.psychorama\.be)$" REQUEST_ORIGIN=$0
        SetEnvIf Origin "^http(s)?://(git\.psychorama\.test)$" REQUEST_ORIGIN=$0
        Header always set Access-Control-Allow-Origin %{REQUEST_ORIGIN}e env=REQUEST_ORIGIN
        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, HEAD"
        Header always set Access-Control-Allow-Headers "x-test-header, Origin, X-Requested-With, Content-Type, Accept, Authorization"

        # Force to request 204 for options
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} ^(OPTIONS|HEAD)
        RewriteRule .* / [R=204,L]
    </Directory>
    # Enable cross domain access control
    SetEnvIf Origin "^http(s)?://(git\.psychorama\.be)$" REQUEST_ORIGIN=$0
    SetEnvIf Origin "^http(s)?://(git\.psychorama\.test)$" REQUEST_ORIGIN=$0
    Header always set Access-Control-Allow-Origin %{REQUEST_ORIGIN}e env=REQUEST_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD"
    Header always set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Accept-Language,Authorization,Sec-Fetch-Site,Sec-Fetch-Dest,Sec-Fetch-Mode,TE"
    Header always set Access-Control-Expose-Headers "Content-Length,Content-Range,Content-Language,Cache-Control,Expires,Last-Modified,Pragma"
    Header always set Access-Control-Allow-Credentials true

    # Force to request 200 for options
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule .* / [R=204,L]

    PassEnv APP_ENV
    PassEnv APP_DEBUG
</VirtualHost>
